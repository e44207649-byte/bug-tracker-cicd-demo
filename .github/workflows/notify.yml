name: ğŸ“¢ Pipeline Notifications

on:
  workflow_call:
    inputs:
      status:
        description: 'Pipeline status (success/failure)'
        required: true
        type: string
      commit_sha:
        description: 'Commit SHA'
        required: true
        type: string
      branch_name:
        description: 'Branch name'
        required: true
        type: string
      author:
        description: 'Author name'
        required: true
        type: string
      production_url:
        description: 'Production URL'
        required: false
        type: string
        default: 'https://bug-tracker-cicd-demo.vercel.app'
      staging_url:
        description: 'Staging URL'
        required: false
        type: string
        default: 'https://bug-tracker-demo-staging.vercel.app'
      job_results:
        description: 'JSON object with job results'
        required: false
        type: string
        default: '{}'

jobs:
  notify-success:
    name: ğŸ“¢ Success Notification
    runs-on: ubuntu-latest
    if: inputs.status == 'success'
    
    steps:
      - name: ğŸ“¢ Pipeline Success Notification
        run: |
          echo "ğŸ‰ ===== PIPELINE SUCCESS ===== ğŸ‰"
          echo ""
          echo "âœ… Quality checks passed"
          echo "âœ… All tests passed"
          echo "âœ… Build successful"
          echo "âœ… Staging deployment successful"
          echo "âœ… Production deployment successful"
          echo "âœ… Health checks passed"
          echo ""
          echo "ğŸŒŸ Production URL: ${{ inputs.production_url }}"
          echo "ğŸ§ª Staging URL: ${{ inputs.staging_url }}"
          echo ""
          echo "ğŸ“Š Commit: ${{ inputs.commit_sha }}"
          echo "ğŸ·ï¸ Branch: ${{ inputs.branch_name }}"
          echo "ğŸ‘¤ Author: ${{ inputs.author }}"
          echo ""
          echo "ğŸš€ Deployment complete!"

  notify-failure:
    name: ğŸš¨ Failure Notification
    runs-on: ubuntu-latest
    if: inputs.status == 'failure'
    
    steps:
      - name: ğŸš¨ Pipeline Failure Notification
        run: |
          echo "ğŸš¨ ===== PIPELINE FAILURE ===== ğŸš¨"
          echo ""
          echo "âŒ Pipeline failed at one or more stages"
          echo ""
          
          # Parse job results if provided
          if [ "${{ inputs.job_results }}" != "{}" ]; then
            echo "Job Results:"
            echo "${{ inputs.job_results }}" | jq -r 'to_entries[] | "   - \(.key): \(.value)"' 2>/dev/null || echo "   - Unable to parse job results"
            echo ""
          fi
          
          echo "ğŸ“Š Commit: ${{ inputs.commit_sha }}"
          echo "ğŸ·ï¸ Branch: ${{ inputs.branch_name }}"
          echo "ğŸ‘¤ Author: ${{ inputs.author }}"
          echo ""
          echo "ğŸ” Check the logs above for details"
          
      - name: ğŸ“§ Send Failure Alert (Optional)
        if: inputs.status == 'failure'
        run: |
          echo "ğŸ’¡ This is where you could add:"
          echo "   - Slack notifications"
          echo "   - Email alerts"
          echo "   - Discord webhooks"
          echo "   - Microsoft Teams notifications"
          echo ""
          echo "Example Slack webhook:"
          echo 'curl -X POST -H "Content-type: application/json" --data "{\"text\":\"ğŸš¨ Pipeline failed for ${{ inputs.branch_name }}\"}" $SLACK_WEBHOOK_URL'